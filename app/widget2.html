<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dynamic Record Counter</title>
  <script src="https://js.zohostatic.com/creator/widgets/version/2.0/widgetsdk-min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h3>Widget Version: <span id="widgetVersion"></span></h3>
  <h2>Count: <span id="recordCount">0</span></h2>

  <script>
    ZOHO.CREATOR.init().then(function() {
      ZOHO.CREATOR.UTIL.getQueryParams().then(function(params) {
        const reportName = params.report_name;
        const criteria = params.criteria;

        function updateCount() {
          const config = {
            app_name: "echo",
            report_name: reportName,
            criteria: criteria
          };

          ZOHO.CREATOR.DATA.getRecordCount(config)
            .then(function(response) {
              const count = response.result.records_count;
              $("#recordCount").text(count);
            })
            .catch(function(err) {
              console.error("Error fetching record count:", err);
            });
        }

        // Initial fetch
        updateCount();

        // Show widget version based on last modified
        document.getElementById("widgetVersion").textContent = new Date(document.lastModified).toLocaleString();

        // Refresh every 5 seconds
        setInterval(updateCount, 5000);
      });
    });
  </script>
</body>
</html>
